<!DOCTYPE html>
<html lang="th">
<!-- ============================================ -->
<!-- LAYER 1: HEAD - META & IMPORTS -->
<!-- ============================================ -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J-Bot Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@300;400;600&display=swap" rel="stylesheet">
    
    <!-- ============================================ -->
    <!-- LAYER 2: CUSTOM STYLES -->
    <!-- ============================================ -->
    <style>
        body { 
            font-family: 'IBM Plex Sans Thai', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card { 
            border: none; 
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .table { 
            border-radius: 10px; 
            overflow: hidden; 
        }
        .badge-active { background: #10b981; }
        .badge-pending { background: #f59e0b; }
        .badge-expired { background: #6b7280; }
    </style>
</head>

<body>
    <div class="container mt-5">
        
        <!-- ============================================ -->
        <!-- LAYER 3: STATISTICS CARDS -->
        <!-- ============================================ -->
        <div class="row mb-4">
            <!-- Total Members -->
            <div class="col-md-3">
                <div class="card shadow-sm bg-primary text-white text-center p-4">
                    <p class="mb-1 fw-light">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    <h2 class="fw-bold">{{ total }}</h2>
                </div>
            </div>
            
            <!-- Active Members -->
            <div class="col-md-3">
                <div class="card shadow-sm bg-success text-white text-center p-4">
                    <p class="mb-1 fw-light">Active</p>
                    <h2 class="fw-bold">{{ active }}</h2>
                </div>
            </div>
            
            <!-- Pending Members -->
            <div class="col-md-3">
                <div class="card shadow-sm bg-warning text-dark text-center p-4">
                    <p class="mb-1 fw-light">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                    <h2 class="fw-bold">{{ pending }}</h2>
                </div>
            </div>
            
            <!-- Expired Members -->
            <div class="col-md-3">
                <div class="card shadow-sm bg-secondary text-white text-center p-4">
                    <p class="mb-1 fw-light">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</p>
                    <h2 class="fw-bold">{{ expired }}</h2>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- LAYER 4: PAGE HEADER & ACTIONS -->
        <!-- ============================================ -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="fw-bold text-white">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å J-Bot Signals</h2>
            <div>
                <a href="/admin/check-expiry" class="btn btn-warning btn-sm me-2">
                    üîÑ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
                </a>
                <a href="/" class="btn btn-light btn-sm">
                    üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏ß‡πá‡∏ö
                </a>
            </div>
        </div>
        
        <!-- ============================================ -->
        <!-- LAYER 5: MEMBERS TABLE -->
        <!-- ============================================ -->
        <div class="table-responsive shadow-sm">
            <table class="table table-hover bg-white mb-0">
                
                <!-- TABLE HEADER -->
                <thead class="table-dark">
                    <tr class="text-center">
                        <th>ID</th>
                        <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                        <th>LINE ID</th>
                        <th>‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</th>
                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                
                <!-- TABLE BODY -->
                <tbody>
                    {% if members %}
                        {% for member in members %}
                        <tr class="text-center align-middle">
                            
                            <!-- ID -->
                            <td>{{ member.id }}</td>
                            
                            <!-- Display Name -->
                            <td class="text-start fw-bold">
                                {{ member.display_name or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠' }}
                            </td>
                            
                            <!-- LINE ID -->
                            <td class="text-start">
                                <code class="text-muted">{{ member.line_id[:20] }}...</code>
                            </td>
                            
                            <!-- Expiry Date -->
                            <td>
                                {{ member.expiry_date.strftime('%d/%m/%Y %H:%M') }}
                            </td>
                            
                            <!-- ============================================ -->
                            <!-- LAYER 6: STATUS LOGIC (3 STATES) -->
                            <!-- ============================================ -->
                            <td>
                                {% if member.is_active and member.expiry_date > now %}
                                    <!-- Active: ‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà + ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ -->
                                    <span class="badge badge-active">‚úÖ Active</span>
                                
                                {% elif not member.is_active %}
                                    <!-- Pending: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ -->
                                    <span class="badge badge-pending">‚è≥ ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>
                                
                                {% elif member.expiry_date <= now %}
                                    <!-- Expired: ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß -->
                                    <span class="badge badge-expired">‚è∞ ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</span>
                                {% endif %}
                            </td>
                            
                            <!-- ============================================ -->
                            <!-- LAYER 7: ACTION BUTTONS -->
                            <!-- ============================================ -->
                            <td>
                                <!-- ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ 30 ‡∏ß‡∏±‡∏ô -->
                                <a href="{{ url_for('approve_member', member_id=member.id) }}" 
                                   class="btn btn-success btn-sm me-1
                                   {% if member.is_active and member.expiry_date > now %}disabled{% endif %}">
                                    ‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ 30 ‡∏ß‡∏±‡∏ô
                                </a>
                                
                                <!-- ‡∏õ‡∏¥‡∏î‡∏ß‡∏≤‡∏•‡πå‡∏ß -->
                                <a href="#" 
                                   class="btn btn-outline-danger btn-sm" 
                                   onclick="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î‡∏ß‡∏≤‡∏•‡πå‡∏ß {{ member.display_name }}?')">
                                    üö´ ‡∏õ‡∏¥‡∏î‡∏ß‡∏≤‡∏•‡πå‡∏ß
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    
                    <!-- Empty State -->
                    {% else %}
                        <tr>
                            <td colspan="6" class="text-center p-5 text-muted">
                                üì≠ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

    </div>

    <!-- ============================================ -->
    <!-- LAYER 8: SCRIPTS (if needed) -->
    <!-- ============================================ -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>